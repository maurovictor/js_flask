<!DOCTYPE html>
<html>
        <head>
                <meta charset="utf-8">
                <title>Registrar conectores</title>
                <meta charset="utf-8">
                <title>Adicionar Placa</title>
                <link rel="stylesheet" href="{{url_for('static', filename = 'css/bootstrap.min.css')}}">
                <link rel="stylesheet" href="{{url_for('static', filename = 'css/bootstrap-theme.min.css')}}">
                <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
                <script src="{{url_for('static', filename = 'js/bootstrap.min.js')}}"></script>
                <script type="text/javascript">
                    $('#myModal').on('shown.bs.modal', function () {
                        $('#myInput').focus()
                        if (!data) return e.preventDefault() // stops modal from being shown
                    })
                </script>
        </head>
        <body>
                <div class="container">
                        <div class="page-header">
                            <h1 class="text-center">JS Placas <small>Testador</small></h1>
                            <ul class="nav nav-pills">
                                <li role="presentation"><a href="{{url_for('test')}}">Testar</a></li>
                                <li role="presentation"><a href="{{url_for('adicionar_placa')}}">Adicionar Placa</a></li>
                                <li role="presentation"><a href="{{url_for('add_defeito')}}">Adicionar Defeito</a></li>
                                <li role="presentation"><a href="{{url_for('connector')}}">Adicionar Conector</a></li>
                            </ul>
                        </div>
                        <div class="col-md-4 col-md-offset-4">
                                <form class="" action="{{connector}}" method="post">
                                        <div class="form-group">
                                                <label for="nome-conector">Nome do Conector</label>
                                                <input type="text" class="form-control" name="connector-name" id="nome-conector">
                                        </div>
                                        <div class="col-md-offset-4">
                                                <button type="submit" name="submit-button" class="btn btn-default">Avan√ßar &nbsp <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span></button>
                                        </div>
                                </form>
                        </div>
                </div>
                <!-- Contact Matrix code -->
                <script type="text/javascript">
                        var canvas = document.getElementById("myCanvas");
                        var ctx = canvas.getContext("2d");
                        ctx.font="30px Arial";

                        ctx.fillStyle = "#d5dbdb";
                        ctx.fillRect(0,0,450,450);
                        ctx.strokeRect(0,0,450,450);
                        //draw vertical lines
                        for (i=1; i <= 8; i++)
                        {
                                ctx.moveTo(i*50,0);
                                ctx.lineTo(i*50, 450);
                                ctx.stroke();
                        }
                        //draw horizontal lines
                        for (i=1; i<=8; i++)
                        {
                                ctx.moveTo(0, i*50);
                                ctx.lineTo(450, i*50);
                                ctx.stroke();
                        }
                        var coordenadas = []
                        ctx.canvas.addEventListener('click', function(event){
                                var rect = canvas.getBoundingClientRect();
                                var mouseX = event.clientX - rect.left;
                                var mouseY = event.clientY - rect.top;
                                var col = Math.round(mouseX/50);
                                var bit = Math.round(mouseY/50);
                                ctx.fillStyle = "#5A6A62";
                                if ((col >=1 & col <= 8) & (bit >=1 & bit <= 8))
                                ctx.fillRect((Math.round(mouseX/50)*50)-10,(Math.round(mouseY/50)*50)-10,20,20);
                                coordenadas.push(col);
                                coordenadas.push(bit);
                        });
                        var limpar = document.getElementById("clean");
                        limpar.addEventListener('click', function(event){
                                ctx.fillStyle = "#d5dbdb";
                                ctx.fillRect(0,0,450,450);
                                ctx.strokeRect(0,0,450,450);
                                for (i=1; i <= 8; i++)
                                {
                                        ctx.moveTo(i*50,0);
                                        ctx.lineTo(i*50, 450);
                                        ctx.stroke();
                                }
                                //draw horizontal lines
                                for (i=1; i<=8; i++)
                                {
                                        ctx.moveTo(0, i*50);
                                        ctx.lineTo(450, i*50);
                                        ctx.stroke();
                                }
                                coordenadas = [];
                        });
                        var bot_enviar = document.getElementById("submit");
                        bot_enviar.addEventListener('click', function(event){
                                console.log(coordenadas);

                                //add connector recently created to select box on the fly
                                var connector_name = document.getElementById("nome-conector").value;
                                var select_conn = document.getElementById("conector");
                                var opt = document.createElement("option");
                                opt.value = connector_name;
                                opt.innerHTML = connector_name;
                                select_conn.appendChild(opt);

                                //Send data to back end assycronously [coordinates and connector name]
                                $.ajax({
                                        type: "POST",
                                        url: "{{url_for('conn_scheema')}}",
                                        data:   {
                                                        c: JSON.stringify(coordenadas),
                                                        name: connector_name
                                                }
                                }).done(function(o) {
                                        console.log('saved');
                                        alert("Conector Salvo");
                                });
                        });
        </body>
</html>
